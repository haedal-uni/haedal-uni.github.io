<!DOCTYPE html><html lang="ko" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Db 저장하기" /><meta property="og:locale" content="ko" /><meta name="description" content="New Project 새로운 프로젝트를 시작했다." /><meta property="og:description" content="New Project 새로운 프로젝트를 시작했다." /><link rel="canonical" href="https://haedal-uni.github.io//posts/DB-%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0/" /><meta property="og:url" content="https://haedal-uni.github.io//posts/DB-%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0/" /><meta property="og:site_name" content="Dal Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-11-01T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Db 저장하기" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-11-01T00:00:00+09:00","datePublished":"2024-11-01T00:00:00+09:00","description":"New Project 새로운 프로젝트를 시작했다.","headline":"Db 저장하기","mainEntityOfPage":{"@type":"WebPage","@id":"https://haedal-uni.github.io//posts/DB-%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0/"},"url":"https://haedal-uni.github.io//posts/DB-%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0/"}</script><title>Db 저장하기 | Dal Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Dal Blog"><meta name="application-name" content="Dal Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://raw.githubusercontent.com/cotes2020/chirpy-images/main/commons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Dal Blog</a></div><div class="site-subtitle font-italic">한 걸음씩</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/haedal-uni" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Db 저장하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4 pb-5"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Db 저장하기</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1730386800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Nov 1, 2024 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/haedal-uni">haedal-uni</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2336 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><h1 id="new-project">New Project</h1><p>새로운 프로젝트를 시작했다.</p><p>영어 공부에 대한 필요성이 느껴져 코딩 연습과 함께 영어 공부 사이트를 만들어 보려고 했다.</p><p>전체코드는 <a href="https://github.com/haedal-uni/eng">eng</a>에서 확인할 수 있다.</p><p><br /><br /><br /></p><h2 id="idea"><span class="mr-2">IDEA</span><a href="#idea" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>아이디어는 별도의 노션에서 계속 정리하고 있으며, 중간에 추가 및 수정이 많아 현재까지 완료한 작업들을 정리하기로 했다.</p><p><br /></p><p><img data-src="https://github.com/user-attachments/assets/7f687b66-4534-45c9-a9f7-bff172c7bf8e" alt="image" width="50%" data-proofer-ignore></p><p>현재 기본적인 구조는 영어 단어 학습과, 빈칸 채우기 퀴즈, 그리고 틀린 부분을 모아서 복습하는 사이트다.</p><p><br /></p><p><img data-src="https://github.com/user-attachments/assets/b12db838-8fb4-46fb-a5ed-3e6dd056ba5d" alt="AC_ 20241030-190759" width="50%" data-proofer-ignore></p><p><br /></p><p>front는 ChatGPT를 통해 기본적인 HTML과 CSS 디자인을 구현하여 개발 시간을 절약했다.</p><p>프로젝트에서 가장 중요한 부분은 데이터 저장 및 성능 개선이다.</p><p>db는 중복을 피하기 위해 관계형 데이터베이스를 사용하고, 데이터 구조가 자주 변경될 일이 거의 없기 때문에 MySQL을 선택했다.</p><p><br /></p><p>아래는 db 저장 방법을 정리한 글이다.</p><p><br /><br /><br /><br /></p><h2 id="flow"><span class="mr-2">Flow</span><a href="#flow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>파일 첨부하기로 엑셀을 업로드하면 3개의 메소드로 나누어 db에 저장한다.</p><p><img data-src="https://github.com/user-attachments/assets/e2e3ab9c-c413-4a92-bff6-071623ac88de" alt="image" data-proofer-ignore></p><p><br /></p><p><strong>1.</strong> 단어 저장하기</p><p><strong>2.</strong> 단어 뜻 저장하기</p><p><strong>3.</strong> 예문, 예문 뜻, level 저장</p><p><br /><br /><br /><br /></p><h2 id="db"><span class="mr-2">DB</span><a href="#db" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="https://github.com/user-attachments/assets/62f1f55c-1ae9-48b6-85be-4eca4f6ad1c1" alt="image" data-proofer-ignore></p><p><br /></p><p>AUTO_INCREMENT는 1부터 시작하도록 설정한다.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="p">[</span><span class="k">Table</span> <span class="err">명</span><span class="p">]</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</pre></table></code></div></div><p><br /><br /></p><h3 id="단어-저장하기"><span class="mr-2">단어 저장하기</span><a href="#단어-저장하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>중복 방지를 위해 단어는 UNIQUE 속성으로 저장했다.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">word</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">word</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="p">);</span>
</pre></table></code></div></div><p><br /><br /><br /></p><h3 id="단어-뜻-저장하기"><span class="mr-2">단어 뜻 저장하기</span><a href="#단어-뜻-저장하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">meaning</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">word_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">meaning</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">word_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">word</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span>
<span class="p">);</span>
</pre></table></code></div></div><p>같은 뜻을 가진 단어가 여러 개 있을 수 있으므로, 단어 뜻은 UNIQUE 제약 조건을 설정하지 않았다.</p><p><br /></p><p>*참고) unique key 생성 및 삭제</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">UNIQUE</span> <span class="k">INDEX</span> <span class="nv">"인덱스 이름"</span><span class="err"> </span><span class="k">ON</span> <span class="nv">"테이블명"</span> <span class="p">(</span><span class="nv">"컬럼명"</span><span class="p">,</span><span class="nv">"컬럼명"</span><span class="p">);</span> <span class="c1">-- 생성</span>
<span class="k">DROP</span> <span class="k">INDEX</span> <span class="nv">"인덱스 이름"</span> <span class="k">ON</span> <span class="nv">"테이블명"</span><span class="p">;</span> <span class="c1">-- 삭제</span>

<span class="k">DROP</span> <span class="k">INDEX</span> <span class="n">user_number</span> <span class="k">ON</span> <span class="k">user</span><span class="p">;</span> <span class="c1">-- user 테이블의 user_number 인덱스 삭제</span>
</pre></table></code></div></div><p><br /><br /><br /></p><h3 id="예문-저장하기"><span class="mr-2">예문 저장하기</span><a href="#예문-저장하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>단어가 아닌 뜻을 fk로 잡은 이유는 특정 뜻에 해당하는 예문을 db에 저장하기 위해서다.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">example</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">meaning_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">example</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">example_meaning</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">800</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">level</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">meaning_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">meaning</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span>
<span class="p">);</span>
</pre></table></code></div></div><p>예문마다 레벨을 설정해 초·중·고 수준에 따라 나눴으며 각각 0, 1, 2로 설정했다.</p><p>이 값을 int로 설정할 것인가 string으로 설정할 것인가에 대해 고민을 하다가</p><p><a href="https://stackoverflow.com/questions/747802/integer-vs-string-in-database">이 글</a>을 보고 어떠한 계산을 하는 것이 아니기 때문에 string으로 설정했었다.</p><p>그런데 엑셀에서 숫자만 입력한 데이터는 string으로 값을 얻지 못해서 int로 저장했다.</p><p><br /><br /><br /><br /></p><h2 id="code"><span class="mr-2">Code</span><a href="#code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="단어-저장하기-1"><span class="mr-2">단어 저장하기</span><a href="#단어-저장하기-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>엑셀에서 가져온 단어 데이터를 Set 자료구조로 중복을 필터링한 뒤, DB에 저장한다.</p><h4 id="entity"><span class="mr-2">Entity</span><a href="#entity" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="nd">@Getter</span>
<span class="nd">@NoArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PROTECTED</span><span class="o">)</span> <span class="c1">// builder</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Word</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">word</span><span class="o">;</span>

    <span class="nd">@Builder</span>
    <span class="kd">public</span> <span class="nf">Word</span><span class="o">(</span><span class="nc">String</span> <span class="n">word</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">;</span>
    <span class="o">}</span>

   <span class="c1">// Set&lt;Word&gt; 중복 단어 필터링(equals와 hashCode 재정의) </span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span> 
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="nc">Word</span> <span class="n">word1</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Word</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
        <span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">word</span><span class="o">,</span> <span class="n">word1</span><span class="o">.</span><span class="na">word</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">word</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><br /><br /></p><h4 id="service"><span class="mr-2">Service</span><a href="#service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveWord</span><span class="o">(</span><span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="nc">Workbook</span> <span class="n">workbook</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XSSFWorkbook</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">());</span> <span class="c1">// workbook : 하나의 엑셀 파일을 의미</span>
    <span class="nc">Sheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">workbook</span><span class="o">.</span><span class="na">getSheetAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span> <span class="c1">// 첫번째 sheet</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Word</span><span class="o">&gt;</span> <span class="n">words</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>
    <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">rowIterator</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">rowIterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">rowIterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span> <span class="c1">// 첫 행(제목) 건너 뛰기</span>
    <span class="o">}</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">rowIterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
        <span class="nc">Row</span> <span class="n">row</span> <span class="o">=</span> <span class="n">rowIterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="nc">Word</span> <span class="n">word</span> <span class="o">=</span> <span class="nc">Word</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">word</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">getCell</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getStringCellValue</span><span class="o">().</span><span class="na">strip</span><span class="o">())</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="n">words</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">word</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// DB에 저장(중복 try~catch)</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">wordRepository</span><span class="o">.</span><span class="na">saveAll</span><span class="o">(</span><span class="n">words</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">DataIntegrityViolationException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 중복 예외 처리</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>1차적으로 엑셀 파일에 중복이 있는지 Set을 사용하여 미리 제거후 db에 저장한다.</p><p>try-catch 블록을 통해 중복이 발생할 경우 <code class="language-plaintext highlighter-rouge">SQLIntegrityConstraintViolationException</code> 예외를 처리했다.</p><p><br /><br /><br /><br /></p><h3 id="단어-뜻-저장하기-1"><span class="mr-2">단어 뜻 저장하기</span><a href="#단어-뜻-저장하기-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>한 단어에 여러 뜻이 있을 경우를 고려하여 단어와 뜻을 분리했다.</p><p><br /></p><h4 id="entity-1"><span class="mr-2">Entity</span><a href="#entity-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="nd">@Getter</span>
<span class="nd">@NoArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PROTECTED</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Meaning</span> <span class="o">{</span>
    <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="no">LAZY</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">REMOVE</span><span class="o">)</span> <span class="c1">// ON DELETE CASCADE</span>
    <span class="nd">@JsonIgnore</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"word_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Word</span> <span class="n">word</span><span class="o">;</span>

    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"meaning"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Sentence</span><span class="o">&gt;</span> <span class="n">sentenceList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">meaning</span><span class="o">;</span>

    <span class="nd">@Builder</span>
    <span class="kd">private</span> <span class="nf">Meaning</span><span class="o">(</span><span class="nc">Word</span> <span class="n">word</span><span class="o">,</span> <span class="nc">String</span> <span class="n">meaning</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">meaning</span> <span class="o">=</span> <span class="n">meaning</span><span class="o">;</span>
        <span class="n">word</span><span class="o">.</span><span class="na">getMeaningList</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Meaning</span> <span class="nf">createMeaning</span><span class="o">(</span><span class="nc">Word</span> <span class="n">word</span><span class="o">,</span> <span class="nc">String</span> <span class="n">meaning</span><span class="o">){</span>
        <span class="k">return</span> <span class="nc">Meaning</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">word</span><span class="o">(</span><span class="n">word</span><span class="o">)</span>
                <span class="o">.</span><span class="na">meaning</span><span class="o">(</span><span class="n">meaning</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>word와 meaning을 일대다 매핑을 하고 연관관계 편의 메소드를 작성하던 도중</p><p>나는 builder 패턴으로 사용해서 연관관계 편의 메소드를 작성만 하고 service에서 사용은 안하고 있었다.</p><p>인프런 [<a href="https://www.inflearn.com/community/questions/419013/%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%ED%8E%B8%EC%9D%98-%EB%A9%94%EC%86%8C%EB%93%9C-%EC%83%9D%EC%84%B1-%EB%A9%94%EC%86%8C%EB%93%9C%EC%97%90-%EB%8C%80%ED%95%B4-%EC%A7%88%EB%AC%B8%EB%93%9C%EB%A0%A4%EC%9A%94?srsltid=AfmBOoo57-8QEf8tSZ4It18EYgEL5PSlZ_BPTaiFgfMkNTNhMV-iepCg">1</a>], [<a href="https://www.inflearn.com/community/questions/655412/%EC%96%91%EB%B0%A9%ED%96%A5-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%ED%8E%B8%EC%9D%98-%EB%A9%94%EC%86%8C%EB%93%9C-%EC%83%9D%EC%84%B1-%EB%A9%94%EC%86%8C%EB%93%9C%EC%97%90-%EB%8C%80%ED%95%B4-%EC%A7%88%EB%AC%B8%EB%93%9C%EB%A6%BD%EB%8B%88%EB%8B%A4?srsltid=AfmBOoroJqGu3G83QUsfW-11Mhgp7f6-fMxU1SJcSkyoNcgpjOMIfekk">2</a>] 글을 보고 참고하여 builder와 연관관계 편의 메소드를 작성해 사용했다.</p><p><br /><br /></p><h4 id="repository"><span class="mr-2">Repository</span><a href="#repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>단어와 뜻이 모두 존재할 경우 중복을 방지하기 위해 EXISTS를 사용하여 중복 체크를 수행했다.</p><p>JPQL에서는 count를 이용해 값 존재 여부를 확인한다.</p><p>단순히 중복이 있는지 확인하고 바로 종료하고 싶어서</p><p>jpql이 아닌 sql을 직접 정의하여 사용하는 방식인 NativeQuery를 사용했다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MeanRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Meaning</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="n">nativeQuery</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"SELECT EXISTS "</span> <span class="o">+</span>
            <span class="s">"(SELECT 1 FROM Meaning m WHERE m.word_id = :wordId AND m.meaning = :meaning)"</span><span class="o">)</span>
    <span class="kt">int</span> <span class="nf">existsByWordAndMeaning</span><span class="o">(</span><span class="nc">Long</span> <span class="n">wordId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">meaning</span><span class="o">);</span>

    <span class="nd">@Query</span><span class="o">(</span><span class="n">nativeQuery</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"SELECT * FROM Meaning m WHERE m.word_id = :wordId AND m.meaning = :meaning LIMIT 1"</span><span class="o">)</span>
    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Meaning</span><span class="o">&gt;</span> <span class="nf">findByMean</span><span class="o">(</span><span class="nc">Long</span> <span class="n">wordId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">meaning</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>*<code class="language-plaintext highlighter-rouge">limit</code>를 사용할 수 있었지만 <code class="language-plaintext highlighter-rouge">EXISTS</code>가 더 빠른 성능을 보이므로 <code class="language-plaintext highlighter-rouge">EXISTS</code>를 활용했다.</p><p>*return 값을 <code class="language-plaintext highlighter-rouge">Optional&lt;Boolean&gt;</code>을 작성하여 <code class="language-plaintext highlighter-rouge">isPresent()</code>로 값이 있는지 체크하는 로직을 작성했지만</p><p>int로 return값을 작성한 것이 더 빠른 성능을 보여 int로 작성했다.</p><p><br /><br /></p><p>EXISTS 쿼리의 반환 결과는 0 또는 1 형태인 것을 <a href="https://www.w3schools.com/mysql/default.asp">MySQL Tutorial</a>을 통해 확인했다.</p><p><img data-src="https://github.com/user-attachments/assets/a93c622b-ffd4-4273-b518-6df810ad9203" alt="image" data-proofer-ignore></p><p><br /><br /></p><p>참고로 “SELECT EXISTS “ + 부분처럼 가독성을 위해 줄바꿈으로 작성할 경우</p><p>공백을 빼먹었는지 확인해준다. 공백을 빼먹으면 SQL 문법 오류가 뜬다.</p><p><br /></p><p><code class="language-plaintext highlighter-rouge">JpaRepository&lt;T, ID&gt;</code></p><p>T: Entity 타입</p><p>ID: Entity의 기본 키 (Primary Key) 타입</p><p><br /><br /></p><h4 id="service-1"><span class="mr-2">Service</span><a href="#service-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="n">wordIdMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveMeaning</span><span class="o">(</span><span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="nc">Workbook</span> <span class="n">workbook</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XSSFWorkbook</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">());</span>
    <span class="nc">Sheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">workbook</span><span class="o">.</span><span class="na">getSheetAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span> <span class="c1">// 첫번째 sheet</span>
    <span class="nc">MultiValueMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedMultiValueMap</span><span class="o">&lt;&gt;();</span> <span class="c1">// key 중복</span>
    <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">rowIterator</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Meaning</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">rowIterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">rowIterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span> <span class="c1">// 첫 행(제목) 건너 뛰기</span>
    <span class="o">}</span>

    <span class="k">while</span> <span class="o">(</span><span class="n">rowIterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
        <span class="nc">Row</span> <span class="n">row</span> <span class="o">=</span> <span class="n">rowIterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">wordText</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">getCell</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getStringCellValue</span><span class="o">().</span><span class="na">strip</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">meaningText</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">getCell</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">getStringCellValue</span><span class="o">().</span><span class="na">strip</span><span class="o">();</span>

        <span class="c1">// 해당 key에 해당하는 값 중복 체크 (1차 중복 체크 - 메모리)</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putIfAbsent</span><span class="o">(</span><span class="n">wordText</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;());</span>
        <span class="k">if</span><span class="o">(!</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">wordText</span><span class="o">)).</span><span class="na">contains</span><span class="o">(</span><span class="n">meaningText</span><span class="o">)){</span>
            <span class="n">map</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">wordText</span><span class="o">,</span><span class="n">meaningText</span><span class="o">);</span>
            <span class="nc">Word</span> <span class="n">word</span> <span class="o">=</span> <span class="n">wordRepository</span><span class="o">.</span><span class="na">findByWord</span><span class="o">(</span><span class="n">wordText</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">NoSuchElementException</span><span class="o">(</span><span class="s">"Word not found: "</span> <span class="o">+</span> <span class="n">wordText</span><span class="o">));</span>
            <span class="n">wordIdMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">getWord</span><span class="o">(),</span> <span class="n">word</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span> <span class="c1">// saveSentence()에서 db 조회 최소화</span>
            <span class="c1">// word와 meaning이 같이 중복인 경우는 새로 추가하지 않음(2차 중복 체크 - DB)</span>
            <span class="kt">int</span> <span class="n">exists</span> <span class="o">=</span> <span class="n">meanRepository</span><span class="o">.</span><span class="na">existsByWordAndMeaning</span><span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">meaningText</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">exists</span><span class="o">==</span><span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Meaning</span><span class="o">.</span><span class="na">createMeaning</span><span class="o">(</span><span class="n">word</span><span class="o">,</span> <span class="n">meaningText</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">// 일괄 저장</span>
    <span class="n">meanRepository</span><span class="o">.</span><span class="na">saveAll</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p><br /><br /><br /><br /></p><h3 id="예문-저장하기-1"><span class="mr-2">예문 저장하기</span><a href="#예문-저장하기-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="service-2"><span class="mr-2">Service</span><a href="#service-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>단어에 해당하는 뜻에 해당하는 예문을 db에 저장한다. <br /> map에는 단어와 예문을 저장한다.</p><ul><li>map에서 단어에 해당하는 예문이 없다면?<ul><li>map에 단어와 예문을 저장한다.<li>Meaning 테이블에서 해당 단어에 해당하는 뜻을 가져온다. <br /> (그냥 뜻을 가져와버리면 해당 단어가 아닌 다른 단어의 동일한 뜻을 가져와버릴 수 있다.)<li>해당 단어의 뜻과 예문이 중복되어있는지 db에서 체크한다.</ul></ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveSentence</span><span class="o">(</span><span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="nc">Workbook</span> <span class="n">workbook</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XSSFWorkbook</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">());</span>
    <span class="nc">Sheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="n">workbook</span><span class="o">.</span><span class="na">getSheetAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">rowIterator</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Sentence</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="nc">MultiValueMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedMultiValueMap</span><span class="o">&lt;&gt;();</span> <span class="c1">// key 중복</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">rowIterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">rowIterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span> <span class="c1">// 첫 행(제목) 건너 뛰기</span>
    <span class="o">}</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">rowIterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
        <span class="nc">Row</span> <span class="n">row</span> <span class="o">=</span> <span class="n">rowIterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">word</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">getCell</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getStringCellValue</span><span class="o">().</span><span class="na">strip</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">meaningText</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">getCell</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">getStringCellValue</span><span class="o">().</span><span class="na">strip</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">sentence</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">getCell</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="na">getStringCellValue</span><span class="o">().</span><span class="na">strip</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">sentence_meaning</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">getCell</span><span class="o">(</span><span class="mi">3</span><span class="o">).</span><span class="na">getStringCellValue</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">level</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">row</span><span class="o">.</span><span class="na">getCell</span><span class="o">(</span><span class="mi">4</span><span class="o">).</span><span class="na">getNumericCellValue</span><span class="o">();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putIfAbsent</span><span class="o">(</span><span class="n">word</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;());</span>
        <span class="k">if</span> <span class="o">(!</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">word</span><span class="o">)).</span><span class="na">contains</span><span class="o">(</span><span class="n">sentence</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">map</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">word</span><span class="o">,</span> <span class="n">sentence</span><span class="o">);</span>
            <span class="nc">Meaning</span> <span class="n">meaning</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">wordIdMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">word</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// db 조회 최소화 </span>
                <span class="n">meaning</span> <span class="o">=</span> <span class="n">meanRepository</span><span class="o">.</span><span class="na">findByMean</span><span class="o">(</span><span class="n">wordIdMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">word</span><span class="o">),</span> <span class="n">meaningText</span><span class="o">).</span><span class="na">orElseThrow</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="nc">Word</span> <span class="n">wordId</span> <span class="o">=</span> <span class="n">wordRepository</span><span class="o">.</span><span class="na">findByWord</span><span class="o">(</span><span class="n">word</span><span class="o">).</span><span class="na">orElseThrow</span><span class="o">();</span>
                <span class="n">meaning</span> <span class="o">=</span> <span class="n">meanRepository</span><span class="o">.</span><span class="na">findByMean</span><span class="o">(</span><span class="n">wordId</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">meaningText</span><span class="o">).</span><span class="na">orElseThrow</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="kt">int</span> <span class="n">exists</span> <span class="o">=</span> <span class="n">sentenceRepository</span><span class="o">.</span><span class="na">existsByMeanAndSentence</span><span class="o">(</span><span class="n">meaning</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">sentence</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">exists</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Sentence</span><span class="o">.</span><span class="na">createSentence</span><span class="o">(</span><span class="n">meaning</span><span class="o">,</span> <span class="n">sentence</span><span class="o">,</span> <span class="n">sentence_meaning</span><span class="o">,</span> <span class="n">level</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">// 일괄 저장</span>
    <span class="n">sentenceRepository</span><span class="o">.</span><span class="na">saveAll</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>실제로 같은 뜻을 넣어두고 해당 단어에 맞는 예문이 저장된것을 확인했다.</p><p><br /><br /><br /><br /></p><p>REFERENCE</p><ul><li><a href="https://velog.io/@youmakemesmile/Spring-Data-JPA-JPQL-%EC%82%AC%EC%9A%A9-%EB%B0%A9%EB%B2%95Query-nativeQuery-DTO-Mapping-function">NativeQuery</a><li><a href="https://kminu.tistory.com/m/58">JPA, JPQL에서 limit 사용하기</a><li><a href="https://anow.tistory.com/80">[MySql] UNIQUE KEY 생성 및 삭제</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/eng-project/'>Eng-Project</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/log/" class="post-tag no-text-decoration" >log</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Db+%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0+-+Dal+Blog&url=https%3A%2F%2Fhaedal-uni.github.io%2F%2Fposts%2FDB-%25EC%25A0%2580%25EC%259E%25A5%25ED%2595%2598%25EA%25B8%25B0%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Db+%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0+-+Dal+Blog&u=https%3A%2F%2Fhaedal-uni.github.io%2F%2Fposts%2FDB-%25EC%25A0%2580%25EC%259E%25A5%25ED%2595%2598%25EA%25B8%25B0%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fhaedal-uni.github.io%2F%2Fposts%2FDB-%25EC%25A0%2580%25EC%259E%25A5%25ED%2595%2598%25EA%25B8%25B0%2F&text=Db+%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0+-+Dal+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="haedal-uni/comments" issue-term="title" label="comments" theme="github-light" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/%ED%86%B5%ED%95%A9-%ED%8C%8C%EC%9D%BC-%EC%9E%91%EC%84%B1%ED%95%98%EA%B8%B0/">통합 파일 작성하기</a><li><a href="/posts/Excel_%EC%9E%90%EB%8F%99%ED%99%94/">Excel_자동화</a><li><a href="/posts/%EB%8B%A8%EC%B6%95%ED%82%A4/">단축키</a><li><a href="/posts/%EA%B4%91%EA%B3%A0-%EB%8D%B0%EC%9D%B4%ED%84%B0/">광고 데이터</a><li><a href="/posts/Google-Analytics/">Google analytics</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/study/">study</a> <a class="post-tag" href="/tags/summary/">summary</a> <a class="post-tag" href="/tags/chat/">Chat</a> <a class="post-tag" href="/tags/log/">log</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/websocket/">WebSocket</a> <a class="post-tag" href="/tags/data-structure/">Data-Structure</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/%EC%84%B1%EB%8A%A5-%EC%B5%9C%EC%A0%81%ED%99%94-%EC%9A%94%EC%95%BD/"><div class="card-body"> <em class="small" data-ts="1731423600" data-df="ll" > Nov 13, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>성능 최적화 요약</h3><div class="text-muted small"><p> 성능 최적화 요약 Chat Project Chat Project를 진행하면서 성능 개선을 위해 여러 가지 최적화 작업을 진행했다. 이를 통해 로딩 시간, 조회 속도 및 응답 시간을 크게 개선했다. 아래는 각 주요 최적화 작업과 성능 테스트 결과의 요약이다. 더 자세한 내용은 관련 링크에서 확인할 수 있다. 1. 채팅 기록 파일 조회 속도 개...</p></div></div></a></div><div class="card"> <a href="/posts/%EC%B2%AB-%EC%8B%9C%EC%9E%91/"><div class="card-body"> <em class="small" data-ts="1657897200" data-df="ll" > Jul 16, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>첫 시작</h3><div class="text-muted small"><p> 이제 여기로! 이전에 Tistory에서 공부했던 부분이나 팀 프로젝트 했던 기록들을 적어왔었다. 회사 다니기 시작하면서 배우는 부분들을 그대로 이어서 작성해야 하나 고민했었는데 이제 여기에 배워 나가는 것들을 정리해보려고 한다😄 Spring, mysql, mybatis</p></div></div></a></div><div class="card"> <a href="/posts/%EC%83%81%ED%98%B8%EC%9E%91%EC%9A%A9%EA%B3%BC-%EC%84%B1%EA%B3%BC-%EB%B6%84%EC%84%9D/"><div class="card-body"> <em class="small" data-ts="1739977200" data-df="ll" > Feb 20, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>상호작용과 성과 분석</h3><div class="text-muted small"><p> 문제 정의 사용자들의 학습성과를 높이려면? 기능 구현을 하면서 사용자들의 학습 성과를 높이려면 어떤 요소가 중요한지 고민하며 분석을 진행했다. 데이터는 Kaggle의 ONLINE EDUCATION SYSTEM REVIEW 데이터를 사용했으며 실제 프로젝트 데이터는 양이 적어 편향된 결과를 가져올 수 있어 제외했다. 데이터 전처리 1 2 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/%EB%A7%88%EC%A7%80%EB%A7%89-%EA%B8%80-%EC%A1%B0%ED%9A%8C/" class="btn btn-outline-primary" prompt="Older"><p>마지막 글 조회</p></a> <a href="/posts/%EB%8B%A8%EC%96%B4-%ED%95%99%EC%8A%B5%ED%95%98%EA%B8%B0/" class="btn btn-outline-primary" prompt="Newer"><p>단어 학습하기</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/haedal-uni">haedal-uni</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/study/">study</a> <a class="post-tag" href="/tags/summary/">summary</a> <a class="post-tag" href="/tags/chat/">Chat</a> <a class="post-tag" href="/tags/log/">log</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/websocket/">WebSocket</a> <a class="post-tag" href="/tags/data-structure/">Data-Structure</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-K7KC8XYH0P"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-K7KC8XYH0P'); }); </script>
