<!DOCTYPE html><html lang="ko" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Quiz 조회하기" /><meta property="og:locale" content="ko" /><meta name="description" content="Quiz 조회 최적화 과정" /><meta property="og:description" content="Quiz 조회 최적화 과정" /><link rel="canonical" href="https://haedal-uni.github.io//posts/Quiz-%EC%A1%B0%ED%9A%8C%ED%95%98%EA%B8%B0/" /><meta property="og:url" content="https://haedal-uni.github.io//posts/Quiz-%EC%A1%B0%ED%9A%8C%ED%95%98%EA%B8%B0/" /><meta property="og:site_name" content="Dal Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-12-10T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Quiz 조회하기" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-12-10T05:21:03+09:00","datePublished":"2024-12-10T00:00:00+09:00","description":"Quiz 조회 최적화 과정","headline":"Quiz 조회하기","mainEntityOfPage":{"@type":"WebPage","@id":"https://haedal-uni.github.io//posts/Quiz-%EC%A1%B0%ED%9A%8C%ED%95%98%EA%B8%B0/"},"url":"https://haedal-uni.github.io//posts/Quiz-%EC%A1%B0%ED%9A%8C%ED%95%98%EA%B8%B0/"}</script><title>Quiz 조회하기 | Dal Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Dal Blog"><meta name="application-name" content="Dal Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://raw.githubusercontent.com/cotes2020/chirpy-images/main/commons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Dal Blog</a></div><div class="site-subtitle font-italic">한 걸음씩</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/haedal-uni" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Quiz 조회하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4 pb-5"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Quiz 조회하기</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1733756400" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 10, 2024 </em> </span> <span> Updated <em class="" data-ts="1733775663" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 10, 2024 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/haedal-uni">haedal-uni</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2069 words"> <em>11 min</em> read</span></div></div></div><div class="post-content"><h1 id="quiz-조회-최적화-과정">Quiz 조회 최적화 과정</h1><p>사용자(<code class="language-plaintext highlighter-rouge">user_id</code>)별로 정답을 맞히지 못한 퀴즈(<code class="language-plaintext highlighter-rouge">correct = false</code>)를 무작위로 10개 조회하는 기능을 구현했다.</p><p>처음에는 간단한 방법을 선택했지만 성능 문제로 인해 최적화 과정을 거쳤고 이를 작성했다.</p><p><br /></p><p>*<code class="language-plaintext highlighter-rouge">study_id</code>, <code class="language-plaintext highlighter-rouge">user_id</code>, <code class="language-plaintext highlighter-rouge">correct</code> 컬럼을 활용했다.</p><p><br /><br /><br /></p><h2 id="1-초기-구현--order-by-rand"><span class="mr-2">1. 초기 구현 : <code class="language-plaintext highlighter-rouge">ORDER BY RAND()</code></span><a href="#1-초기-구현--order-by-rand" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>처음에는 <code class="language-plaintext highlighter-rouge">ORDER BY RAND()</code>를 사용해 무작위로 데이터를 조회했다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nd">@Query</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"SELECT * FROM quiz q where q.correct=false and q.user_id = :userId order by RAND() limit 10"</span><span class="o">,</span> <span class="n">nativeQuery</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Quiz</span><span class="o">&gt;</span> <span class="nf">findQuizByInCorrect</span><span class="o">(</span><span class="nc">Long</span> <span class="n">userId</span><span class="o">);</span>
</pre></table></code></div></div><p>그러나 <code class="language-plaintext highlighter-rouge">ORDER BY RAND()</code>는 대량의 데이터를 다룰 경우 속도가 매우 느려진다는 단점이 있었다.</p><p><br /><br /></p><p><strong>대안 찾기</strong></p><p>application에서 랜덤 숫자를 생성해 해당 id 값을 조회하려고 했지만</p><p>사용자 별로 <code class="language-plaintext highlighter-rouge">study_id</code>가 연속적이지 않아 적합하지 않았다.</p><p><br /><br /></p><p>*JPQL → Entity 이름 사용</p><p>*Native SQL → DB table 이름 사용</p><p>자세한 내용은 <a href="https://haedal-uni.github.io/posts/Quiz-%EC%A1%B0%ED%9A%8C%ED%95%98%EA%B8%B0/#%EC%B6%94%EA%B0%80-%EC%84%A4%EB%AA%85">하단</a>에 작성했다.</p><p><br /><br /><br /><br /></p><h2 id="2-개선--row_number-를-활용"><span class="mr-2">2. 개선 : <strong><code class="language-plaintext highlighter-rouge">ROW_NUMBER()</code></strong> 를 활용</span><a href="#2-개선--row_number-를-활용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><strong><code class="language-plaintext highlighter-rouge">ROW_NUMBER()</code></strong> 는 결과 집합의 각 행에 고유 번호를 부여한다.</p><p>번호는 그룹별로 정렬 기준(<code class="language-plaintext highlighter-rouge">ORDER BY</code>)에 따라 할당되며 번호는 항상 1부터 시작한다.</p><p><br /></p><p>그룹화 : <strong><code class="language-plaintext highlighter-rouge">PARTITION BY</code></strong> 는 그룹별로 번호를 부여하거나 생략하면 전체 데이터를 하나의 그룹으로 처리한다. (선택)</p><p><br /></p><p>정렬 : <code class="language-plaintext highlighter-rouge">ORDER BY</code> 는 행의 순서를 정의한다. (번호 부여 순서 지정) (필수)</p><p><br /><br /></p><p><strong>예시)</strong></p><p><code class="language-plaintext highlighter-rouge">study_id = [1, 3, 6, 15]</code> → <code class="language-plaintext highlighter-rouge">ROW_NUMBER() = [1, 2, 3, 4]</code></p><p>→ <code class="language-plaintext highlighter-rouge">ROW_NUMBER()</code>를 사용하면 id가 중간에 비어 있어도 영향을 받지 않는다.</p><div class="table-wrapper"><table><thead><tr><th><strong>study_id</strong><th><strong>ROW_NUMBER</strong><tbody><tr><td>1<td>1<tr><td>3<td>2<tr><td>6<td>3</table></div><p><br /><br /></p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">ROW_NUMBER</span><span class="p">()</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">user_id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">study_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">r</span><span class="p">,</span> <span class="n">quiz</span><span class="p">.</span><span class="o">*</span>
<span class="k">FROM</span> <span class="n">quiz</span><span class="p">;</span>
</pre></table></code></div></div><div class="table-wrapper"><table><thead><tr><th><strong>user_id</strong><th><strong>study_id</strong><th><strong>ROW_NUMBER</strong><tbody><tr><td>1<td>1<td>1<tr><td>1<td>3<td>2<tr><td>2<td>2<td>1<tr><td>2<td>4<td>2</table></div><p><br /><br /><br /><br /></p><h3 id="랜덤-숫자-생성"><span class="mr-2">랜덤 숫자 생성</span><a href="#랜덤-숫자-생성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>쿼리에서 랜덤하게 데이터를 선택하기 위해 <code class="language-plaintext highlighter-rouge">MOD</code>와 <code class="language-plaintext highlighter-rouge">FLOOR</code>를 활용했다.</p><p><code class="language-plaintext highlighter-rouge">RAND()</code> : 0과 1 사이의 난수를 반환</p><p><code class="language-plaintext highlighter-rouge">FLOOR()</code> : 소수점 이하를 버리고 정수로 변환</p><p><code class="language-plaintext highlighter-rouge">MOD(a, b)</code> : a를 b로 나눈 나머지를 반환</p><p><br /></p><p><code class="language-plaintext highlighter-rouge">FLOOR(RAND() * n)</code> : 0 ~ n-1 범위의 정수 생성</p><ul><li><code class="language-plaintext highlighter-rouge">FLOOR(RAND() * 3)</code> → 0, 1, 2<li><code class="language-plaintext highlighter-rouge">FLOOR(RAND() * 10)</code> → 0 ~ 9<li><code class="language-plaintext highlighter-rouge">FLOOR(RAND() * 100)</code> → 0 ~ 99</ul><p><br /><br /></p><p><strong>개선된 쿼리</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nd">@Query</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"select * from "</span> <span class="o">+</span>
        <span class="s">"(select row_number() over(order by id) r, quiz.* "</span> <span class="o">+</span>
        <span class="s">"from quiz "</span> <span class="o">+</span>
        <span class="s">"where correct = false and user_id = :userId) sub "</span> <span class="o">+</span>
        <span class="s">"where mod(r, floor(rand() * 3) + 1 ) = 0 limit 10"</span><span class="o">,</span> <span class="n">nativeQuery</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Quiz</span><span class="o">&gt;</span> <span class="nf">findRandomQuiz</span><span class="o">(</span><span class="nc">Long</span> <span class="n">userId</span><span class="o">);</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">RAND() * 3</code> : 0 ~ 3 미만의 난수를 생성</p><p><code class="language-plaintext highlighter-rouge">FLOOR(RAND() * 3) + 1</code> : 1 ~ 3 범위의 정수를 생성</p><p><code class="language-plaintext highlighter-rouge">MOD(r, FLOOR(RAND() * 3) + 1) = 0</code> : r을 랜덤 값으로 나눴을 때 나머지가 0인 값만 선택</p><p><code class="language-plaintext highlighter-rouge">Limit 10</code> : 최대 10개의 결과값 반환(만약 10보다 적은 데이터라면 그만큼의 데이터수만 가져다 준다.)</p><p><br /></p><p>ex) <br /> MOD(1, 3) = 1 (조건 불만족) <br /> MOD(2, 3) = 2 (조건 불만족) <br /> MOD(3, 3) = 0 (조건 만족)</p><p>결과적으로 r = 3, 6, 9, …가 조건을 만족한다.</p><p>매번 실행될 때 다른 난수를 반환하므로 랜덤 조건이 적용되었다.</p><p><br /><br /></p><p>참고) <code class="language-plaintext highlighter-rouge">r</code>은 단순히 필터링된 데이터셋에서 순번을 나타내는 컬럼이며</p><p><code class="language-plaintext highlighter-rouge">where</code> 조건에 따라서 해당 컬럼들을 <code class="language-plaintext highlighter-rouge">select</code>에 작성해야해서 <code class="language-plaintext highlighter-rouge">quiz.*</code>로 작성했다.</p><p>서브쿼리는 반드시 별칭(alias)을 지정해야해서 <code class="language-plaintext highlighter-rouge">sub</code>로 작성했다.</p><p><br /><br /><br /><br /></p><h2 id="3-성능-비교-및-분석"><span class="mr-2">3. 성능 비교 및 분석</span><a href="#3-성능-비교-및-분석" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>기존 쿼리(<code class="language-plaintext highlighter-rouge">ORDER BY RAND()</code>)와 개선된 쿼리(<code class="language-plaintext highlighter-rouge">ROW_NUMBER()</code>)의 성능을 비교했다.</p><p>*편의상 일부 코드를 생략했다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nc">List</span><span class="o">&lt;</span><span class="nc">StudyResponseDto</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

<span class="c1">// 1번</span>
<span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Quiz</span><span class="o">&gt;</span> <span class="n">quizByInCorrect</span> <span class="o">=</span> <span class="n">quizRepository</span><span class="o">.</span><span class="na">findQuizByInCorrect</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="kt">long</span> <span class="n">end</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"시간 소요 1 : {} "</span><span class="o">,</span> <span class="o">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="o">));</span>

<span class="c1">// 2번</span>
<span class="kt">long</span> <span class="n">start1</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Quiz</span><span class="o">&gt;</span> <span class="n">randomQuiz</span> <span class="o">=</span> <span class="n">quizRepository</span><span class="o">.</span><span class="na">findRandomQuiz</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="kt">long</span> <span class="n">end1</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"시간 소요 2 : {} "</span><span class="o">,</span> <span class="o">(</span><span class="n">end1</span><span class="o">-</span><span class="n">start1</span><span class="o">));</span>
</pre></table></code></div></div><p><br /></p><p>quiz 2는 랜덤으로 n칸씩 띄어서 가져오기 때문에 데이터의 개수에 따라서 10개 미만으로 나올 수도 있다.</p><p>따라서 2번째 test부터 quiz 1의 limit를 5로 고정해서 테스트 했다.</p><p><br /></p><p>평균적으로 6개를 조회하는데</p><p><code class="language-plaintext highlighter-rouge">ORDER BY RAND()</code>는 0.085862초, <code class="language-plaintext highlighter-rouge">ROW_NUMBER()</code>는 0.018174초가 걸렸다.</p><p>개선한 쿼리가 약 4.7배 빠른 성능을 보였다.</p><div class="table-wrapper"><table><thead><tr><th><strong>Test Case</strong><th><strong>Quiz 1 (ORDER BY RAND)</strong><th><strong>Quiz 2 (ROW_NUMBER)</strong><tbody><tr><td><strong>Run 1</strong><td>121,789,400 (10개)<td>2,491,901 (5개)<tr><td><strong>Run 2</strong><td>128,090,999 (5개)<td>35,581,300 (8개)<tr><td><strong>Run 3</strong><td>79,390,300 (5개)<td>13,276,901 (7개)<tr><td><strong>Run 4</strong><td>35,747,301 (5개)<td>23,408,500 (7개)<tr><td><strong>Run 5</strong><td>64,292,000 (5개)<td>16,110,600 (6개)</table></div><p><br /><br /></p><p><img data-src="https://github.com/user-attachments/assets/89e2477c-ff62-438c-af51-ca5d379e622e" alt="image" width="30%" data-proofer-ignore></p><p><img data-src="https://github.com/user-attachments/assets/20969248-ee9a-4810-8162-c7552917f2aa" alt="image" width="30%" data-proofer-ignore></p><p><img data-src="https://github.com/user-attachments/assets/7cd9cae6-f016-4a8c-8543-23d5cff6bb91" alt="image" width="30%" data-proofer-ignore></p><p><img data-src="https://github.com/user-attachments/assets/5dc7d218-b479-4edd-830f-b46dc3d20e77" alt="image" width="30%" data-proofer-ignore></p><p><img data-src="https://github.com/user-attachments/assets/47ff63dc-b16e-4377-bdd2-51717b5c540b" alt="image" width="30%" data-proofer-ignore></p><p><br /><br /><br /><br /></p><h3 id="성능-차이-분석"><span class="mr-2">성능 차이 분석</span><a href="#성능-차이-분석" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>개선한 쿼리도 <code class="language-plaintext highlighter-rouge">order by</code>는 쓰이고 있지만 성능 차이가 발생하는 이유에 대해서 분석해봤다.</p><p><br /></p><p>DBMS에서 인덱스는 데이터의 읽기 속도를 높이는 기능이다.</p><p>pk는 레코드(하나의 행)를 대표하는 column의 값으로 만들어진 index를 의미한다.</p><p><br /><br /></p><h4 id="1-order-by-rand"><span class="mr-2">1. <code class="language-plaintext highlighter-rouge">ORDER BY RAND()</code></span><a href="#1-order-by-rand" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>임의 정렬 방식: <code class="language-plaintext highlighter-rouge">RAND()</code>로 각 레코드에 임의의 값을 부여하고 이를 정렬하여 결과를 반환한다.</p><li><p>인덱스 활용X: <code class="language-plaintext highlighter-rouge">ORDER BY RAND()</code>를 이용한 임의 정렬이나 조회는 인덱스를 사용할 수 없다.</p><li><p>전체 데이터 정렬: <code class="language-plaintext highlighter-rouge">WHERE</code> 조건을 만족하는 데이터를 모두 가져와 임의값으로 정렬한 후 제한(<code class="language-plaintext highlighter-rouge">LIMIT</code>)을 적용한다.</p></ul><p><br /><br /></p><h4 id="2-row_number"><span class="mr-2">2. <code class="language-plaintext highlighter-rouge">ROW_NUMBER()</code></span><a href="#2-row_number" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><p>인덱스 활용: <code class="language-plaintext highlighter-rouge">ROW_NUMBER()</code>를 사용해 데이터를 정렬할 때 인덱스를 활용해서 불필요한 정렬 작업을 줄였다.</p><li><p>정렬 효율성: 실제 인덱스 값이 정렬된 상태이므로 순서대로 읽는 작업만 수행한다.</p><li><p>추가적인 정렬 생략: MySQL 서버는 인덱스를 활용할 경우 추가적인 정렬 작업을 하지 않는다.</p></ul><p><br /><br /></p><p><code class="language-plaintext highlighter-rouge">ORDER BY RAND()</code>는 WHERE 조건에 맞는 데이터를 모두 가져온 후 정렬하며</p><p><code class="language-plaintext highlighter-rouge">ROW_NUMBER()</code>는 조건에 맞는 데이터를 가져오며 정렬까지 처리하므로 성능차이가 발생한 것 같다.</p><p><br /><br /><br /><br /></p><hr /><h3 id="추가-설명"><span class="mr-2">추가 설명)</span><a href="#추가-설명" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="jpql"><span class="mr-2">JPQL</span><a href="#jpql" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>JPQL(Java Persistence Query Language)는 JPA에서 SQL을 추상화하여 만든 객체 지향 쿼리 언어다.</p><p>Entity 중심 : db 테이블이 아닌 entity를 대상으로 쿼리를 작성한다.</p><p>ORM 친화적: 데이터베이스의 구체적인 테이블 이름이나 필드 이름을 몰라도 Entity와 매핑된 데이터를 처리할 수 있다.</p><p>데이터베이스 독립적 : JPQL은 SQL을 추상화해서 특정 데이터베이스 SQL에 의존하지 않는다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT u FROM User u WHERE u.name = :name"</span><span class="o">)</span>
</pre></table></code></div></div><p>여기서 <code class="language-plaintext highlighter-rouge">User</code>는 JPA 엔티티 이름이다.</p><p><br /><br /></p><h4 id="native-sql"><span class="mr-2">Native SQL</span><a href="#native-sql" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>SQL 그대로 사용: DB에 직접 SQL 쿼리를 실행하며 테이블 이름과 컬럼 이름을 명시적으로 사용한다.</p><p>데이터베이스 의존적: DB 고유의 SQL 문법(예: 특정 함수나 확장 기능)을 사용할 수 있다.</p><p>유연성: JPQL로 처리하기 어려운 복잡한 쿼리를 작성할 수 있다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nd">@Query</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"SELECT * FROM user WHERE name = :name"</span><span class="o">,</span> <span class="n">nativeQuery</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
</pre></table></code></div></div><p>여기서 <code class="language-plaintext highlighter-rouge">user</code>는 데이터베이스의 테이블 이름이다.</p><p><br /><br /></p><h4 id="정리"><span class="mr-2">정리</span><a href="#정리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="table-wrapper"><table><thead><tr><th><strong>항목</strong><th><strong>JPQL</strong><th><strong>Native SQL</strong><tbody><tr><td><strong>기준</strong><td>Entity 기반<td>테이블 기반<tr><td><strong>유연성</strong><td>JPA와 매핑된 객체만 조회 가능<td>모든 SQL 기능 사용 가능<tr><td><strong>의존성</strong><td>데이터베이스 독립적<td>데이터베이스 종속적<tr><td><strong>예시</strong><td><code class="language-plaintext highlighter-rouge">@Query("SELECT u FROM User u")</code><td><code class="language-plaintext highlighter-rouge">@Query(value = "SELECT * FROM user", nativeQuery = true)</code></table></div><p><br /><br /><br /><br /></p><p><strong>REFERENCE</strong> <br /> <code class="language-plaintext highlighter-rouge">ROW_NUMBER()</code></p><ul><li><a href="https://developjuns.tistory.com/42">[MSSQL] 윈도우 함수 ROW_NUMBER() 순차번호 할당</a><li><a href="https://milku.tistory.com/102">[Oracle] 몫, 나머지 구하기</a><li><a href="https://wakestand.tistory.com/545">MySQL RAND 함수 사용법 및 범위 지정방법</a></ul><p>Order by</p><ul><li>[Real MySQL 8.0]<li><a href="https://velog.io/@cateto/mysql-ORDER-BY-rand">[mysql] ORDER BY rand()</a></ul><p>JPQL</p><ul><li><a href="https://seongwon.dev/Spring-MVC/20220829-JPA-JPQL/">[JPA] JPQL이란?</a><li><a href="https://burningfalls.github.io/java/difference-between-jpql-and-native-sql-in-spring-data-jpa/">[Spring] Spring Data JPA에서 JPQL과 Native SQL의 차이는?</a><li><a href="https://ururuwave.tistory.com/131">[JPA 기본] 객체지향 쿼리 언어 알아보기</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/eng-project/'>Eng-Project</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/log/" class="post-tag no-text-decoration" >log</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Quiz+%EC%A1%B0%ED%9A%8C%ED%95%98%EA%B8%B0+-+Dal+Blog&url=https%3A%2F%2Fhaedal-uni.github.io%2F%2Fposts%2FQuiz-%25EC%25A1%25B0%25ED%259A%258C%25ED%2595%2598%25EA%25B8%25B0%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Quiz+%EC%A1%B0%ED%9A%8C%ED%95%98%EA%B8%B0+-+Dal+Blog&u=https%3A%2F%2Fhaedal-uni.github.io%2F%2Fposts%2FQuiz-%25EC%25A1%25B0%25ED%259A%258C%25ED%2595%2598%25EA%25B8%25B0%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fhaedal-uni.github.io%2F%2Fposts%2FQuiz-%25EC%25A1%25B0%25ED%259A%258C%25ED%2595%2598%25EA%25B8%25B0%2F&text=Quiz+%EC%A1%B0%ED%9A%8C%ED%95%98%EA%B8%B0+-+Dal+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="haedal-uni/comments" issue-term="title" label="comments" theme="github-light" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/%ED%86%B5%ED%95%A9-%ED%8C%8C%EC%9D%BC-%EC%9E%91%EC%84%B1%ED%95%98%EA%B8%B0/">통합 파일 작성하기</a><li><a href="/posts/Excel_%EC%9E%90%EB%8F%99%ED%99%94/">Excel_자동화</a><li><a href="/posts/%EB%8B%A8%EC%B6%95%ED%82%A4/">단축키</a><li><a href="/posts/%EA%B4%91%EA%B3%A0-%EB%8D%B0%EC%9D%B4%ED%84%B0/">광고 데이터</a><li><a href="/posts/Google-Analytics/">Google analytics</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/study/">study</a> <a class="post-tag" href="/tags/summary/">summary</a> <a class="post-tag" href="/tags/chat/">Chat</a> <a class="post-tag" href="/tags/log/">log</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/websocket/">WebSocket</a> <a class="post-tag" href="/tags/data-structure/">Data-Structure</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/%EC%84%B1%EB%8A%A5-%EC%B5%9C%EC%A0%81%ED%99%94-%EC%9A%94%EC%95%BD/"><div class="card-body"> <em class="small" data-ts="1731423600" data-df="ll" > Nov 13, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>성능 최적화 요약</h3><div class="text-muted small"><p> 성능 최적화 요약 Chat Project Chat Project를 진행하면서 성능 개선을 위해 여러 가지 최적화 작업을 진행했다. 이를 통해 로딩 시간, 조회 속도 및 응답 시간을 크게 개선했다. 아래는 각 주요 최적화 작업과 성능 테스트 결과의 요약이다. 더 자세한 내용은 관련 링크에서 확인할 수 있다. 1. 채팅 기록 파일 조회 속도 개...</p></div></div></a></div><div class="card"> <a href="/posts/%EC%B2%AB-%EC%8B%9C%EC%9E%91/"><div class="card-body"> <em class="small" data-ts="1657897200" data-df="ll" > Jul 16, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>첫 시작</h3><div class="text-muted small"><p> 이제 여기로! 이전에 Tistory에서 공부했던 부분이나 팀 프로젝트 했던 기록들을 적어왔었다. 회사 다니기 시작하면서 배우는 부분들을 그대로 이어서 작성해야 하나 고민했었는데 이제 여기에 배워 나가는 것들을 정리해보려고 한다😄 Spring, mysql, mybatis</p></div></div></a></div><div class="card"> <a href="/posts/%EC%83%81%ED%98%B8%EC%9E%91%EC%9A%A9%EA%B3%BC-%EC%84%B1%EA%B3%BC-%EB%B6%84%EC%84%9D/"><div class="card-body"> <em class="small" data-ts="1739977200" data-df="ll" > Feb 20, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>상호작용과 성과 분석</h3><div class="text-muted small"><p> 문제 정의 사용자들의 학습성과를 높이려면? 기능 구현을 하면서 사용자들의 학습 성과를 높이려면 어떤 요소가 중요한지 고민하며 분석을 진행했다. 데이터는 Kaggle의 ONLINE EDUCATION SYSTEM REVIEW 데이터를 사용했으며 실제 프로젝트 데이터는 양이 적어 편향된 결과를 가져올 수 있어 제외했다. 데이터 전처리 1 2 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/gutter/" class="btn btn-outline-primary" prompt="Older"><p>Gutter</p></a> <a href="/posts/Levenshtein-distance%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-%EB%B9%88%EC%B9%B8-%EC%B1%84%EC%9A%B0%EA%B8%B0/" class="btn btn-outline-primary" prompt="Newer"><p>Levenshtein distance를 활용한 빈칸 채우기</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/haedal-uni">haedal-uni</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/study/">study</a> <a class="post-tag" href="/tags/summary/">summary</a> <a class="post-tag" href="/tags/chat/">Chat</a> <a class="post-tag" href="/tags/log/">log</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/websocket/">WebSocket</a> <a class="post-tag" href="/tags/data-structure/">Data-Structure</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-K7KC8XYH0P"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-K7KC8XYH0P'); }); </script>
